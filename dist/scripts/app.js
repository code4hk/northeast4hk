"use strict";angular.module("nt4hk",["ngRoute","ngAnimate","ui.bootstrap","ui.bootstrap.carousel","leaflet-directive","nvd3ChartDirectives","angular-intro","cgBusy"]).config(["$routeProvider",function(e){e.when("/map",{templateUrl:"templates/northeast.html",controller:"MapCtrl",reloadOnSearch:!1}),e.otherwise({redirectTo:"/map"})}]).directive("navByKeys",["$document",function(e){return{restrict:"A",link:function(t,a){e.on("keydown",function(e){function a(){e.preventDefault(),t.$apply()}37===e.which?(t.prev(),a()):39===e.which||32===e.which?(t.next(),a()):27===e.which&&(t.$dismiss(),a())}),a.on("$destroy",function(){e.off("keydown")})}}}]).controller("MapInfoAccordionCtrl",["$scope",function(e){e.oneAtATime=!0,e.isShowAreaChart=!0,e.showAreaChart=function(t){e.isShowAreaChart="true"==t}}]).controller("ModalInstanceCtrl",["$scope","$sce",function(e,t){e.slides=[],e.activeIndex=0,e.myInterval=5e3;e.prev=function(){e.activeIndex>0&&e.activeIndex--},e.next=function(){e.activeIndex<e.slides.length-1&&e.activeIndex++};var a=[{image:"/images/slide_2030.jpg",text:"<h4>新界東北發展計劃背景資料</h4><br />港英政府於1990年代已開始研究發展新界東北成爲新市鎮。1998年，項目被納入香港政府的全港發展策略檢討，惟後來經歷香港經濟衰退，計劃一度被擱置。2007年，香港政府發表《香港2030》，建議開拓古洞北、粉嶺北及坪輋／打鼓嶺新發展區和洪水橋新發展區。 香港行政長官曾蔭權於同年《施政報告》中表示，恢復對這些地區進行新市鎮的規劃及工程研究。",sources:[{ref:"維基百科新界東北發展計劃條目",url:"https://zh.wikipedia.org/wiki/新界東北發展計劃"}]},{image:"/images/slide_plan.jpg",text:'計劃中政府展開三階段公眾參與：<ul><li>2008年11月－2009年3月：第一階段公眾參與</li><li>2009年11月－2010年3月：第二階段公眾參與</li><li>2012年6月－2012年9月：第三階段公眾參與 <a href="http://www.nentnda.gov.hk/chi/public_3.html#PER" taget="_blank">報告</a></li></ul><br/>2013年7月發表<a href="http://www.nentnda.gov.hk/chi/revised_rodp.html" target="_blank">經修訂的發展方案</a><br />2013年12月20日刊憲<a target="_blank" href="http://www.ozp.tpb.gov.hk/pdf/s_ktn_1_c.pdf">古洞北</a>及<a target="_blank" href="http://www.ozp.tpb.gov.hk/pdf/s_fln_1_c.pdf">粉嶺北</a>法定圖則',sources:[{ref:"官方活動時間表",url:"http://www.nentnda.gov.hk/chi/timetable.html"}]},{image:"/images/slide_3consult.jpg",text:"2012年8月18日， 政府於粉嶺祥華社區會堂舉行居民大會，不過場地只能夠容納320人。場面混亂，整個諮詢會舉行了不足30分鐘就告吹。延至2012年9月22日，香港政府於上水寶運路草地舉行最後一次公眾論壇，有約6,000人登記入場。發展局局長陳茂波於會上多次被質疑為何香港「無地建屋」，回應時首次披露，香港政府現時持有的4,000多公頃土地（約9個天水圍面積）之說實屬誤解，事實上只有2,100多公頃為住宅用地，當中6成，即1,200公頃需要預留予原居民興建丁屋；撥歸一般市民的公私營住宅地只有480公頃。陳茂波說，會確保新市鎮是香港人的新市鎮，包括興建公共屋邨和居屋，私營房屋都是中小型單位，以及引入港人港地條款等。諮詢會結束後，陳茂波等官員在數十名警務人員的護送下，擾攘了10多分鐘才能夠乘車離開現場；其間有人向他掟水樽，更幾乎擊中陳，有人更向官員掟示威物品及撒陰司紙。",sources:[{ref:"維基百科新界東北發展計劃條目",url:"https://zh.wikipedia.org/wiki/新界東北發展計劃"},{ref:"圖片：蘋果"}]},{image:"/images/slide_lam.jpg",text:"2012年，林鄭月娥（時任發展局局長）在立法會回答議員時提及，會採取這傳統新市鎮發展模式，用公帑收回所需土地以免除公眾對官商勾結利益輸送的憂慮。2013年陳茂波推出「傳統新市鎮發展模式加強版」容許業主補地價後自行興建樓宇出售，毋須先交回土地予政府再公開競投。",sources:[{ref:"發展局局長與傳媒談話內容",url:"http://www.devb.gov.hk/tc/sdev/press/index_id_7364.html"},{ref:"on.cc圖片",url:"http://orientaldaily.on.cc/cnt/news/20120924/00176_025.html"}]},{image:"/images/slide_cmp.jpg",text:"2013年7月《蘋果》揭發，陳茂波太太許步明及家人在古洞北發展區擁有最少三幅農地，由陳於94年以35萬元親自買入，政府收地時估計可坐收1,245萬元賠償，大賺35倍。陳茂波家族持有的三幅相連地皮位於古洞北河上鄉路附近，佔地近1.5萬平方呎，與新發展區擬建的古洞鐵路站僅數十米之隔。陳茂波回應指自己在持有古洞地皮的Orient Express沒有實際權益，稱「該公司是我太太及其家人的」，而《蘋果》取得 該海外公司文件顯示，公司大股東許步明持有九成股份，餘下一成由陳茂波兒子陳天行（Chan Tian Hsing）持有，",sources:[{ref:"硬銷東北　陳茂波囤地自肥",url:"http://hk.apple.nextmedia.com/news/art/20130722/18343730"}]},{image:"/images/slide_conflict_of_interest.gif",text:"2013年8月蘋果日報對新界東北住宅發展區域逾1,500個地段查冊，審視區內土地業權分佈，發現四大發展商已瓜分逾552萬呎地，其中恒基地產、長實和新世界有逾四成土地座落私人發展區，可換地自行發展，單是恒地估計就坐收300億元。「4000平方米直接發展」的政策被指是向囤積農地的四大地產商度身訂造。2014年6月6日立法會規劃署助理署長胡潔貞否認在規劃時政府有作業權調查，陳茂波於6月15日卻指政府在08至09年發展有關項目前，曾聘請顧問做研究，當中包括業權資料。",sources:[{ref:"蘋果日報報導及圖片－恒地長實新世界東北發展大贏家 逾四成土地座落私人發展區",url:"http://hk.apple.nextmedia.com/news/art/20130826/18394803"},{ref:"影片－2014年6月6日張超雄立法會質問政府有否作業權調查",url:"https://www.youtube.com/watch?v=3i5ShVvjOrw"},{ref:"RTHK報導- 發展東北　陳茂波稱業權誰屬非考慮因素",url:"https://hk.news.yahoo.com/%E7%99%BC%E5%B1%95%E6%9D%B1%E5%8C%97-%E9%99%B3%E8%8C%82%E6%B3%A2%E7%A8%B1%E6%A5%AD%E6%AC%8A%E8%AA%B0%E5%B1%AC%E9%9D%9E%E8%80%83%E6%85%AE%E5%9B%A0%E7%B4%A0-014800334.html"},{ref:"獨立媒體－政府公然欺騙立法會 隱瞞曾進行新界東北業權調查",url:"http://www.inmediahk.net/node/1023554"}]},{image:"/images/slide_jun6.jpg",text:"2014年6月6日，立法會審議新界東北發展區的前期撥款申請期間，上百名反對新界東北發展計劃的示威者衝入立法會，並且發生佔領立法會事件。6月13日，逾千名反東北發展群眾在立法會外外集會，觀看會議直播，要求政府撤回新界東北發展計劃。由於會內議員提出大量臨時動議「拉布」，撥款一直未能表決。凌晨2時，警方加強警力，展開清場行動。",sources:[{ref:"維基百科新界東北發展計劃條目",url:"https://zh.wikipedia.org/wiki/新界東北發展計劃"},{ref:"獨立媒體圖片",url:"http://www.ntdtv.com/xtr/b5/2014/06/06/a1114680.html"}]},{image:"/images/slide_jun27.png",text:"2014年6月27日，立法會財委會上，新界東北發展計劃前期撥款，主席吳亮星趁泛民議員群起離座與其議論，宣佈開始表決。撥款以29票贊成對2票反對，獲得通過。在會議10點結束前數分鐘，泛民議員指表決結果非法，表明會進行司法覆核。會議甫結束，吳亮星即在多名保安護送下離開會議廳。會議期間泛民議員反覆提出規程問題，吳亮星均僅簡短回應，數度無視會議法律顧問的意見，連針對主席的不信任動議也沒有處理，更曾三度驅逐議員離開會議廳（但兩度自行撤銷裁決）。根據財委會會議程序，主席須在表決前詢問議員是否有進一步提問，但吳亮星限制每名議員，僅可提出一條問題並限時一分鐘；議員批評此決定不符會議程序，吳亮星沒有處理。",sources:[{ref:"主場新聞圖片及報導：東北前期撥款通過 泛民圍主席台吳亮星強行表決",url:"http://thehousenews.com/NT-northeast/%E6%9D%B1%E5%8C%97%E5%89%8D%E6%9C%9F%E6%92%A5%E6%AC%BE%E9%80%9A%E9%81%8E-%E6%B3%9B%E6%B0%91%E5%9C%8D%E4%B8%BB%E5%B8%AD%E5%8F%B0%E5%90%B3%E4%BA%AE%E6%98%9F%E5%BC%B7%E8%A1%8C%E8%A1%A8%E6%B1%BA/"},{ref:"財務委員會通過新界東北前期撥款前後影片",url:"https://www.youtube.com/watch?v=BKOmjirCPls"}]}];_.each(a,function(a){e.slides.push({text:t.trustAsHtml(a.text),image:a.image,sources:a.sources})})}]).factory("q",function(){return Q}).service("spreadSheetDataService",["$http","q",function(e,t){var a="https://spreadsheets.google.com/feeds/list/1wgGlXYbGUNIBu4TX3UAC334iI1KwwGbynZlF3-NNv4s/746094374/public/values?alt=json",n="https://spreadsheets.google.com/feeds/list/1wgGlXYbGUNIBu4TX3UAC334iI1KwwGbynZlF3-NNv4s/1670720169/public/values?alt=json",o={};return o.getSpreadSheet=function(a){return t(e.get(a)).then(function(e){return e.data.feed.entry})},o.getAreaByDetails=function(){return o.getSpreadSheet(a)},o.getPointOfInterest=function(){return o.getSpreadSheet(n)},o}]).service("mapDataService",["$http","q",function(e,t){var a={};return a.getShapesGeoJSON=function(){return t(e.get("/data/basic_areas_merged.geojson"))},a}]).controller("MapCtrl",["$scope","mapDataService","spreadSheetDataService","leafletData","$location","$modal","$interpolate",function(e,t,a,n,o,i,r){e.status={isFirstOpen:!0,isFirstDisabled:!1,isPPChartOpen:!1,isNewsOpen:!1,isLegendOpen:!1},e.IntroOptions={steps:[{element:"#map",intro:"地圖放大可見分區規劃圖層、右上角可選擇顯示圖層；點擊標記可見相關資料、點擊地區可看該區數據。",position:"top"},{element:"#landuse",intro:"可見分區／總合土地分佈圖",position:"bottom"},{element:"#housing",intro:"可見總合公私營房屋分佈",position:"bottom"}],showStepNumbers:!1,exitOnOverlayClick:!0,showBullets:!1,exitOnEsc:!0,nextLabel:"<strong>NEXT</strong>",prevLabel:'<span style="color:green">Previous</span>',skipLabel:"OK",doneLabel:"OK",overlayOpacity:.1},e.onAfterChange=function(t){"housing"===t.id&&(e.status.isPPChartOpen=!0,e.$apply())},e.openModal=function(){var t=i.open({templateUrl:"templates/modal-content.html",controller:"ModalInstanceCtrl",windowClass:"background-modal",resolve:{items:function(){return e.items}}});t.result.then(function(){},function(){}),t.result.finally(function(){o.search("background",null)})},e.openVideoModal=function(){var t=i.open({templateUrl:"templates/modal-video.html",resolve:{items:function(){return e.items}}});t.result.then(function(){},function(){}),t.result.finally(function(){o.search("video",null)})},e.loadingInfoPromise={},e.$on("$locationChangeSuccess",function(){var t=o.search().background?!0:!1,a=o.search().video?!0:!1;t?e.openModal():a&&e.openVideoModal()}),e.openModal(),e.selectArea=function(t){e.areaSelectedId=t},e.defaultCenter={lat:22.52349854314378,lng:114.12760734558105,zoom:13},e.displayedMarkers={},e.defaults={reuseTiles:!0,maxZoom:17},e.legend={position:"bottomleft",colors:["#ff0000","#28c9ff","#0000ff","#ecf386"],labels:["National Cycle Route","Regional Cycle Route","Local Cycle Network","Cycleway"]},t.getShapesGeoJSON().then(function(t){function n(e){return e&&p[e]?p[e].color:"#f86767"}function o(e){return"undefined"!=typeof p[e].opacity?p[e].opacity:1}function i(t){e.areaSelectedId=t.properties.id}function l(t){function a(e){return"housing_"+e+"_"+t}var n=[],o=e.areaSelected.dataMap,i=0;return _.each(u,function(e){var t=a(e);i+=parseFloat(o[t].size)}),_.each(u,function(e){var t=a(e);o[t]&&n.push({key:o[t].key,y:o[t].size,percent:(o[t].size/i*100).toFixed(2)})}),n}function s(){var t=[];return _.each(e.areaSelected.sizeByType,function(a,n){if("area_total"!==n&&"population"!==n){var o=0,i=0,r="";parseFloat(a.size)&&(o=parseFloat(a.size).toFixed(2)),o>0&&(i=(o/e.areaSelected.sizeByType.area_total.size*100).toFixed(2)),a.description&&(r=a.description),t.push({key:a.key,y:o,percent:i})}}),t}function c(){_.each(p,function(e,t){_.contains(["s_fln_1","s_ktn_1"],t)&&(_.each(e.sizeByType,function(e,t){p.total.sizeByType[t]||(p.total.sizeByType[t]={},p.total.sizeByType[t].key=e.key,p.total.sizeByType[t].size=0),parseFloat(e.size)&&(p.total.sizeByType[t].size+=parseFloat(e.size))}),p.total.dataMap.population.size+=parseInt(e.dataMap.population.size))})}e.displayedGeoJSON={},e.areaSelected={},e.areaSelectedId="";var p={fln_golf:{name:"粉嶺哥爾夫球場",color:"#16B900",center:{lat:22.491741758372008,lng:114.11580562591551}},s_ktn_1:{name:"古洞北",color:"blue",center:{lat:22.508195934393456,lng:114.10469055175781},opacity:0},s_fln_1:{name:"粉嶺北",color:"#f86767",center:{lat:22.509147441324007,lng:114.13310050964355},opacity:0},s_ne_tkl_14:{name:"坪輋（重新規劃）",color:"#f86767"}};e.$on("leafletDirectiveMap.geojsonClick",function(e,t,a){i(t,a)}),e.areaChartTooltipFunction=function(){return function(e,t,a){return"<h4>"+e+"</h4><p>"+t+" 公頃 "+a.point.percent+"%</p>"}},e.ppChartTooltipFunction=function(){return function(e,t,a){return"<h4>"+e+"</h4><p>"+t+" 公頃 "+a.point.percent+"%</p>"}};var u=["sub_public_mix","sub","private"];e.$watch("areaSelectedId",function(t){t&&(e.areaSelected=p[e.areaSelectedId],e.areaSelected.center&&(e.defaultCenter=angular.copy(e.areaSelected.center),e.defaultCenter.zoom="total"===t?13:15),e.chartByAreaData=s(),e.ppChartBySize=l("size"),e.ppChartByUnit=l("unit"))}),e.chartByAreaData=[],_.each(p,function(e,t){p[t].news={},p[t].sizeByType={},p[t].dataMap={}}),p.total={name:"古洞北及粉嶺北"},p.total.center=angular.copy(e.defaultCenter),p.total.news={},p.total.sizeByType={},p.total.dataMap={population:{key:"population",size:0}};var d=(a.getPointOfInterest().then(function(t){function a(e,t,a){var o="<ul>";return _.each(a,function(e){o+='<li><a target="_blank" href="'+e.sourceLink+'">'+e.sourceName+"</a>"}),o+="<ul>",r(n)({label:e,details:t})+o}var n='<h6><b>{{label}}</b><span class="pull-right">{{date}}</span></h6><div>{{details}}</div>相關資料：',o={};_.each(t,function(e){var t=e.gsx$lat.$t,a=e.gsx$lng.$t,n=e.gsx$event.$t,i=e.gsx$sourceid.$t;if(""!==t&&""!==a){var r=e.gsx$source.$t,l=e.gsx$sourcelink.$t,s=e.gsx$eventfulldetails.$t,c=t+"_"+a,p={sourceName:r,sourceLink:l};if(o[c])o[c].sources.push(p);else{var u={lat:parseFloat(t),lng:parseFloat(a),label:n,details:s,key:i,zoom:15,sources:[p]};o[c]=u}}});var i={};_.each(o,function(e){e.message=a(e.label,e.details,e.sources),i[e.key]=e}),angular.extend(e.displayedMarkers,i)}),a.getAreaByDetails().then(function(t){_.each(t,function(e){var t=e.gsx$areaid.$t;if(t&&_.contains(_.keys(p),t)){var a=e.gsx$typelabeleng.$t,n=e.gsx$description.$t;a.match(/^area_.+/)?p[t].sizeByType[a]={key:e.gsx$typelabeltc.$t,size:e.gsx$areasize.$t,description:n}:""!==a&&(p[t].dataMap[a]={},p[t].dataMap[a].key=e.gsx$typelabeltc.$t,p[t].dataMap[a].size=e.gsx$areasize.$t)}}),c(),e.areaSelectedId="total"}).fail(function(){}));e.loadingInfoPromise=d,e.displayedGeoJSON.style=function(e){return{fillColor:n(e.properties.id),weight:1.5,opacity:1,color:"blue",fillOpacity:o(e.properties.id)}},e.displayedGeoJSON.data=t.data}),e.maxBounds={},e.layers={baselayers:{osm:{name:"OpenStreetMap",type:"xyz",url:"http://b.tile2.opencyclemap.org/transport/{z}/{x}/{y}.png",layerOptions:{subdomains:["a","b","c"],attribution:"© OpenStreetMap contributors",continuousWorld:!0}}},overlays:{s_ktn_1_left:{name:"古洞北規劃圖",type:"imageOverlay",url:"/data/nent_nda_left_onepiece_A_left.png",bounds:[[22.497,114.083],[22.5257,114.126]],visible:!0,layerOptions:{noWrap:!0,opacity:.8}},s_ktn_1_right:{name:"粉嶺北規劃圖",type:"imageOverlay",url:"/data/nent_nda_left_onepiece_A_right_rotated.png",bounds:[[22.4948,114.1145],[22.5241,114.153]],visible:!0,layerOptions:{noWrap:!0,opacity:.8}},toxic_layer:{name:"古洞砒霜分佈地層",type:"imageOverlay",url:"/data/toxicarea_layer.png",bounds:[[22.497,114.083],[22.5257,114.126]],visible:!0,layerOptions:{noWrap:!0,opacity:.8}}}},e.xFunction=function(){return function(e){return e.key}},e.yFunction=function(){return function(e){return e.y}}}]);